using Microsoft.AspNetCore.Mvc;
using Oracle.ManagedDataAccess.Client;
using FiapWebAPI.Models;

namespace FiapWebAPI.Repository
{
    public class RemedioRepository
    {
        private readonly string connectionString;
        public RemedioRepository()
        {
            connectionString = new ConfigurationBuilder()
                    .SetBasePath(Directory.GetCurrentDirectory())
                    .AddJsonFile("appsettings.json")
                    .Build().GetConnectionString("FiapWebAPIConnection");
        }

            public IList<Remedio> List()
            {
                IList<Remedio> lista = new List<Remedio>();

                using (OracleConnection connection = new OracleConnection(connectionString))
                {
                    String query = "SELECT NM_REMEDIO, DOSG_REMEDIO, COR_REMEDIO FROM T_REMEDIO";

                    OracleCommand command = new OracleCommand(query, connection);
                connection.Open();
                    OracleDataReader dataReader = command.ExecuteReader();

                    while (dataReader.Read())
                    {
                        Models.Remedio remedio = new Models.Remedio();
                        remedio.Nome = dataReader["NM_REMEDIO"].ToString();
                        remedio.Dosagem = Convert.ToInt32(dataReader["DOSG_REMEDIO"]);
                        remedio.Cor = dataReader["COR_REMEDIO"].ToString();

                        lista.Add(remedio);
                    }
                    connection.Close();
                }

                return lista;

            }
            public Models.Remedio Detail(String Nome)
            {

                Models.Remedio remedio = new Models.Remedio();

                using (OracleConnection connection = new OracleConnection(connectionString))
                {
                    String query =
                        "SELECT NM_REMEDIO, DOSG_REMEDIO, COR_REMEDIO FROM T_REMEDIO WHERE NM_REMEDIO = :nome_id ";

                    OracleCommand command = new OracleCommand(query, connection);
                    command.Parameters.Add("nome_id", Nome);
                    connection.Open();

                    OracleDataReader dataReader = command.ExecuteReader();

                    while (dataReader.Read())
                    {
                        remedio.Nome = dataReader["NM_REMEDIO"].ToString();
                        remedio.Dosagem = Convert.ToInt32(dataReader["DOSG_REMEDIO"]);
                        remedio.Cor = dataReader["COR_REMEDIO"].ToString();
                    }

                    connection.Close();
                }

                return remedio;
            }

            public void Create(Models.Remedio remedio)
            {

                using (OracleConnection connection = new OracleConnection(connectionString))
                {
                    String query =
                        "INSERT INTO T_REMEDIO ( NM_REMEDIO, DOSG_REMEDIO, COR_REMEDIO ) VALUES ( :nome, :dosg, :cor )";

                    OracleCommand command = new OracleCommand(query, connection);

                    command.Parameters.Add("nome", remedio.Nome);
                    command.Parameters.Add("dosg", Convert.ToDouble(remedio.Dosagem));
                    command.Parameters.Add("cor", remedio.Cor);

                    connection.Open();
                    command.ExecuteNonQuery();
                    connection.Close();

                }
            }

            public void Edit(Models.Remedio remedio)
            {

                using (OracleConnection connection = new OracleConnection(connectionString))
                {
                    String query =
                        "UPDATE T_REMEDIO SET NM_REMEDIO = :nome , DOSG_REMEDIO = :dosg, COR_REMEDIO = :cor WHERE NM_REMEDIO = :nome_id  ";

                    OracleCommand command = new OracleCommand(query, connection);

                    command.Parameters.Add("nome", remedio.Nome);
                    command.Parameters.Add("dosg", Convert.ToDouble(remedio.Dosagem));
                    command.Parameters.Add("cor", remedio.Cor);
                    command.Parameters.Add("nome_id", remedio.Nome);

                    connection.Open();
                    command.ExecuteNonQuery();
                    connection.Close();

                }
            }

            public void Delete(String Nome)
            {

                using (OracleConnection connection = new OracleConnection(connectionString))
                {
                    String query =
                        "DELETE T_REMEDIO WHERE NM_REMEDIO = :nome_id";

                    OracleCommand command = new OracleCommand(query, connection);

                    command.Parameters.Add("nome_id", Nome);

                    connection.Open();
                    command.ExecuteNonQuery();
                    connection.Close();
                }

            }

    }
}